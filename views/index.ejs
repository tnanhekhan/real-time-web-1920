<%- include ("./partials/head.ejs") %>

<div>
    <h1><%= title %></h1>
    <p>Welcome to <%= title %></p>
</div>
<!--<iframe width="560" height="315" src="https://www.youtube.com/embed/h-ydIFHBPU8" frameborder="0"-->
<!--        allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>-->
<ul id="messages"></ul>
<form id="chat-bar" action="">
    <input id="m" autocomplete="off"/>
    <button>Send</button>
</form>

<script src="/socket.io/socket.io.js"></script>
<script>
    const socket = io();
    const messages = document.getElementById("messages");
    const form = document.forms["chat-bar"]

    form.addEventListener("submit", event => {
        socket.emit('chat message', form.elements.m.value);
        form.elements.m.value = "";
        event.preventDefault(); // prevents page reloading
    });

    socket.on('chat message', msg => {
        if (new RegExp("^(http(s)?:\/\/)?((w){3}.)?youtu(be|.be)?(\.com)?\/.+").test(msg.trim())) {
            const message = document.createElement("li");
            const link = document.createElement("a");
            message.appendChild(document.createTextNode(msg));
            message.appendChild(document.createElement())
            messages.appendChild(message);
        } else {
            const message = document.createElement("li");
            message.appendChild(document.createTextNode(msg));
            messages.appendChild(message);
        }
    });

</script>
<%- include ("./partials/footer.ejs") %>